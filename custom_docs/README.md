# Documentation Personnalis√©e - Marker PDF

Cette documentation personnalis√©e fournit des scripts avanc√©s et des guides d'utilisation pour exploiter pleinement les capacit√©s de Marker, un outil de conversion de documents PDF en markdown avec une pr√©cision √©lev√©e.

## üìÅ Structure du R√©pertoire

```
custom_docs/
‚îú‚îÄ‚îÄ inputs/          # R√©pertoire pour vos fichiers PDF d'entr√©e
‚îú‚îÄ‚îÄ outputs/         # R√©pertoire pour les r√©sultats de conversion
‚îú‚îÄ‚îÄ scripts/         # Scripts Python personnalis√©s
‚îÇ   ‚îú‚îÄ‚îÄ analyze_pdf_deep.py        # Analyse approfondie de PDFs
‚îÇ   ‚îú‚îÄ‚îÄ convert_to_markdown.py     # Conversion optimis√©e vers Markdown
‚îÇ   ‚îú‚îÄ‚îÄ extract_specific_content.py # Extraction de contenu sp√©cifique
‚îÇ   ‚îî‚îÄ‚îÄ batch_processor.py         # Traitement en lot avanc√©
‚îî‚îÄ‚îÄ README.md        # Ce fichier
```

## üöÄ Scripts Disponibles

### 1. `analyze_pdf_deep.py` - Analyse Approfondie de PDF

**Objectif :** Analyser en profondeur la structure et le contenu d'un PDF pour comprendre sa complexit√© et optimiser le traitement.

```bash
# Analyse basique
python scripts/analyze_pdf_deep.py inputs/document.pdf

# Analyse avec LLM pour une meilleure pr√©cision
python scripts/analyze_pdf_deep.py inputs/document.pdf --llm

# Analyse en mode debug avec sauvegarde
python scripts/analyze_pdf_deep.py inputs/document.pdf --debug --output outputs/
```

**Fonctionnalit√©s :**
- ‚úÖ Analyse de la structure du document (hi√©rarchie, complexit√©)
- ‚úÖ √âvaluation de la qualit√© du texte extractible
- ‚úÖ D√©tection des √©l√©ments sp√©ciaux (tableaux, √©quations, formulaires)
- ‚úÖ Recommandations de traitement optimales
- ‚úÖ Statistiques d√©taill√©es par page

**Sortie :**
```json
{
  "structure_analysis": {
    "total_pages": 25,
    "reading_complexity": "complex",
    "block_counts": {"Text": 120, "Table": 8, "Equation": 15},
    "content_distribution": {"Text": 85, "Table": 8, "Figure": 12}
  },
  "quality_analysis": {
    "confidence_score": 0.85,
    "text_extraction_methods": {"pdftext": 20, "ocr": 5}
  },
  "recommendations": [
    "Utiliser --use_llm pour une meilleure pr√©cision",
    "Nombreuses √©quations - utiliser --force_ocr avec --use_llm"
  ]
}
```

### 2. `convert_to_markdown.py` - Conversion Optimis√©e vers Markdown

**Objectif :** Convertir des PDFs en markdown avec diff√©rents niveaux d'optimisation selon vos besoins de qualit√©/vitesse.

```bash
# Conversion rapide (mode par d√©faut)
python scripts/convert_to_markdown.py inputs/document.pdf

# Conversion √©quilibr√©e qualit√©/vitesse
python scripts/convert_to_markdown.py inputs/document.pdf --mode balanced

# Conversion haute qualit√© avec LLM
python scripts/convert_to_markdown.py inputs/document.pdf --mode quality --output outputs/

# Traitement en lot d'un r√©pertoire
python scripts/convert_to_markdown.py --batch inputs/ --output outputs/ --mode balanced
```

**Modes disponibles :**

| Mode | Description | Use Case | Vitesse | Qualit√© |
|------|-------------|----------|---------|---------|
| `fast` | Conversion rapide, qualit√© basique | Prototypage, tests | ‚ö°‚ö°‚ö° | ‚≠ê‚≠ê |
| `balanced` | √âquilibre qualit√©/vitesse | Usage quotidien | ‚ö°‚ö° | ‚≠ê‚≠ê‚≠ê |
| `quality` | Qualit√© maximale avec LLM | Documents importants | ‚ö° | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |

**Sortie :**
- üìÑ Fichier Markdown principal
- üìä M√©tadonn√©es JSON (table des mati√®res, statistiques)
- üñºÔ∏è Images extraites (dans un sous-dossier)
- üìà Rapport de conversion d√©taill√©

### 3. `extract_specific_content.py` - Extraction de Contenu Sp√©cifique

**Objectif :** Extraire s√©lectivement des types de contenu sp√©cifiques (tables, √©quations, images, formulaires) d'un PDF.

```bash
# Extraction de toutes les tables
python scripts/extract_specific_content.py inputs/document.pdf --content-type tables --output outputs/

# Extraction des √©quations avec LLM
python scripts/extract_specific_content.py inputs/document.pdf --content-type equations --llm

# Extraction d'images et figures
python scripts/extract_specific_content.py inputs/document.pdf --content-type images --output outputs/

# Extraction de sections par mots-cl√©s
python scripts/extract_specific_content.py inputs/document.pdf --content-type sections \
  --keywords "introduction,methodology,results,conclusion" --output outputs/

# Extraction de formulaires (LLM recommand√©)
python scripts/extract_specific_content.py inputs/document.pdf --content-type forms --llm --output outputs/
```

**Types de contenu support√©s :**
- üìä `tables` - Tables avec export CSV automatique
- üßÆ `equations` - √âquations et formules math√©matiques (LaTeX)
- üñºÔ∏è `images` - Images et figures avec l√©gendes
- üìã `forms` - Formulaires avec champs d√©tect√©s
- üìñ `sections` - Sections par mots-cl√©s avec score de pertinence

### 4. `batch_processor.py` - Traitement en Lot Avanc√©

**Objectif :** Traiter efficacement de nombreux PDFs avec gestion parall√®le, retry automatique et monitoring en temps r√©el.

```bash
# Traitement parall√®le basique
python scripts/batch_processor.py inputs/ outputs/

# Traitement avec LLM et format JSON
python scripts/batch_processor.py inputs/ outputs/ --llm --format json

# Contr√¥le fin du parall√©lisme
python scripts/batch_processor.py inputs/ outputs/ --strategy parallel --workers 4

# Traitement s√©quentiel (plus s√ªr pour les gros documents)
python scripts/batch_processor.py inputs/ outputs/ --strategy sequential

# Traitement avec OCR forc√©
python scripts/batch_processor.py inputs/ outputs/ --force-ocr --llm
```

**Strat√©gies de traitement :**

| Strat√©gie | Description | Cas d'usage | Performance |
|-----------|-------------|-------------|-------------|
| `sequential` | Un fichier √† la fois | Documents volumineux, debug | Lent, s√ªr |
| `parallel` | Multi-processus | Usage g√©n√©ral | Rapide, efficace |
| `multi_gpu` | Distribu√© GPU | Tr√®s gros volumes | Tr√®s rapide |

**Fonctionnalit√©s avanc√©es :**
- üîÑ Retry automatique en cas d'√©chec
- üìä Monitoring temps r√©el de la progression  
- üíæ Rapports d√©taill√©s de traitement
- ‚ö° Optimisation automatique du nombre de workers
- üñ•Ô∏è Support multi-GPU (avec configuration appropri√©e)

## üìã Guide d'Utilisation Rapide

### Workflow Recommand√©

1. **Analyse pr√©liminaire** : Commencez toujours par analyser votre PDF
```bash
python scripts/analyze_pdf_deep.py inputs/document.pdf --output outputs/
```

2. **Conversion adapt√©e** : Choisissez le mode selon les recommandations
```bash
# Si complexit√© "simple" ou "moderate"
python scripts/convert_to_markdown.py inputs/document.pdf --mode balanced --output outputs/

# Si complexit√© "complex" ou "very_complex"  
python scripts/convert_to_markdown.py inputs/document.pdf --mode quality --output outputs/
```

3. **Extraction sp√©cialis√©e** (si n√©cessaire) : Pour des besoins sp√©cifiques
```bash
python scripts/extract_specific_content.py inputs/document.pdf --content-type tables --output outputs/
```

### Configuration des Cl√©s API (pour mode LLM)

Pour utiliser les fonctionnalit√©s LLM (mode `--llm` ou `--mode quality`), configurez vos cl√©s API :

```bash
# Gemini (recommand√©)
export GOOGLE_API_KEY="your_gemini_api_key"

# Ou Claude
export CLAUDE_API_KEY="your_claude_api_key"

# Ou OpenAI
export OPENAI_API_KEY="your_openai_api_key"
```

## üéØ Cas d'Usage Sp√©cifiques

### üìö Documents Acad√©miques
```bash
# Analyse approfondie
python scripts/analyze_pdf_deep.py inputs/paper.pdf --llm --output outputs/

# Conversion haute qualit√©
python scripts/convert_to_markdown.py inputs/paper.pdf --mode quality --output outputs/

# Extraction des √©quations
python scripts/extract_specific_content.py inputs/paper.pdf --content-type equations --llm --output outputs/
```

### üìä Rapports Financiers
```bash
# Extraction des tables
python scripts/extract_specific_content.py inputs/rapport.pdf --content-type tables --llm --output outputs/

# Conversion avec OCR forc√©
python scripts/convert_to_markdown.py inputs/rapport.pdf --mode quality --output outputs/
```

### üìã Formulaires et Documents Administratifs
```bash
# Extraction des formulaires
python scripts/extract_specific_content.py inputs/formulaire.pdf --content-type forms --llm --output outputs/

# Conversion avec structure pr√©serv√©e
python scripts/convert_to_markdown.py inputs/formulaire.pdf --mode quality --output outputs/
```

### üè≠ Traitement en Masse
```bash
# Analyse de tout un r√©pertoire
for pdf in inputs/*.pdf; do
    python scripts/analyze_pdf_deep.py "$pdf" --output outputs/analyses/
done

# Traitement en lot optimis√©
python scripts/batch_processor.py inputs/ outputs/ --strategy parallel --llm --format markdown
```

## üîß Optimisation des Performances

### Recommandations Mat√©rielles

| Configuration | CPU | RAM | GPU | Workers Recommand√©s |
|---------------|-----|-----|-----|-------------------|
| Basique | 4 cores | 8 GB | - | 2-3 |
| Standard | 8 cores | 16 GB | - | 4-6 |
| Haute Performance | 16+ cores | 32+ GB | RTX 3080+ | 8-12 |
| Serveur | 32+ cores | 64+ GB | A100/H100 | 16+ |

### Monitoring des Ressources

```bash
# Surveillance pendant le traitement
watch -n 1 'ps aux | grep python | grep -E "(marker|convert)" | wc -l; free -h; nvidia-smi'
```

## üö® R√©solution de Probl√®mes

### Erreurs Communes

| Erreur | Cause | Solution |
|--------|-------|----------|
| `Out of memory` | RAM insuffisante | R√©duire `--workers` ou utiliser `--strategy sequential` |
| `CUDA out of memory` | VRAM insuffisante | R√©duire les workers ou d√©sactiver GPU |
| `API rate limit` | Trop de requ√™tes LLM | Ajouter des pauses ou r√©duire la concurrence |
| `File not found` | Chemin incorrect | V√©rifier les chemins absolus/relatifs |

### Logs et Debug

```bash
# Activation du mode debug d√©taill√©
python scripts/analyze_pdf_deep.py inputs/document.pdf --debug

# Consultation des logs de traitement en lot
tail -f batch_processing.log

# V√©rification des r√©sultats JSON pour debug
jq '.structure_analysis.reading_complexity' outputs/document_analysis.json
```

## üìà Mesure de Performance

### Benchmarks Typiques

| Type Document | Pages | Mode Fast | Mode Balanced | Mode Quality |
|---------------|-------|-----------|---------------|--------------|
| Article Acad√©mique | 10-20 | 15s | 30s | 90s |
| Rapport Financier | 50-100 | 45s | 120s | 300s |
| Manuel Technique | 100-500 | 120s | 400s | 1200s |

*Tests sur Intel i7-10700K, 32GB RAM, RTX 3080*

### M√©triques de Qualit√©

- **Pr√©cision du texte** : >95% avec mode quality
- **Pr√©servation du formatage** : >90% pour tables et listes
- **Extraction d'√©quations** : >85% avec LLM activ√©
- **D√©tection d'images** : >98% de rappel

## üìû Support et Contribution

### Obtenir de l'Aide

1. Consultez les logs d√©taill√©s dans `batch_processing.log`
2. Utilisez le mode `--debug` pour plus d'informations
3. V√©rifiez la configuration des cl√©s API
4. Testez avec un document simple d'abord

### Personnalisation

Les scripts sont con√ßus pour √™tre facilement modifiables :

- Ajoutez vos propres types de contenu dans `extract_specific_content.py`
- Personnalisez les configs de traitement dans `convert_to_markdown.py`  
- √âtendez les m√©triques d'analyse dans `analyze_pdf_deep.py`
- Impl√©mentez de nouvelles strat√©gies dans `batch_processor.py`

---

**üìù Note :** Cette documentation √©volue avec le projet. Pour les derni√®res mises √† jour, consultez les commentaires dans chaque script.